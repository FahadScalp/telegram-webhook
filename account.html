<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Account View</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 p-4">
  <div class="max-w-xl mx-auto bg-white p-6 rounded shadow">
    <h1 class="text-xl font-bold text-blue-800 mb-4" id="accountTitle">Account</h1>

    <div id="accountInfo" class="text-sm space-y-2 mb-4"></div>

    <div id="loginSection" class="mb-4">
      <h2 class="text-md font-semibold mb-2">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h2>
      <input type="text" id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" class="w-full p-2 border rounded mb-2" />
      <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" class="w-full p-2 border rounded mb-2" />
      <button onclick="handleLogin()" class="w-full bg-blue-600 text-white p-2 rounded">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      <p id="loginError" class="text-red-500 text-sm hidden mt-2">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©</p>
    </div>

    <div id="alertForm" class="hidden border p-3 bg-blue-50 rounded">
      <h2 class="text-md font-semibold mb-2">ğŸ”” Ø¥Ø¹Ø¯Ø§Ø¯ ØªÙ†Ø¨ÙŠÙ‡ ØªÙ„ØºØ±Ø§Ù…</h2>
      <input type="text" placeholder="Bot Token" class="p-1 border rounded w-full mb-2" id="token" />
      <input type="text" placeholder="Chat ID" class="p-1 border rounded w-full mb-2" id="chat" />
      <input type="text" placeholder="Message" class="p-1 border rounded w-full mb-2" id="msg" />
      <button class="bg-green-600 text-white px-4 py-2 rounded" onclick="saveAlert()">Ø­ÙØ¸ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</button>
    </div>
  </div>

  <script>
    const accountId = window.location.pathname.split("/").pop();
    let accountData = null;

    async function loadAccount() {
      const res = await fetch("/accounts");
      const all = await res.json();
      accountData = all[accountId];
      if (!accountData) {
        document.getElementById("accountTitle").innerText = "âš ï¸ Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯";
        return;
      }

      const last = accountData.history[accountData.history.length - 1];
      const profit = (last.balance - 100).toFixed(2);
      const html = \`
        <div><strong>Ø§Ù„Ø§Ø³Ù…:</strong> \${accountData.alias}</div>
        <div><strong>Ø§Ù„Ø±Ù‚Ù…:</strong> \${accountId}</div>
        <div><strong>Ø§Ù„Ø±ØµÙŠØ¯:</strong> \$\${last.balance.toFixed(2)}</div>
        <div><strong>Ø§Ù„Ø±Ø¨Ø­:</strong> \$\${profit}</div>
        <div><strong>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</strong> \${new Date(last.timestamp).toLocaleString()}</div>
      \`;
      document.getElementById("accountInfo").innerHTML = html;
    }

    function handleLogin() {
      const user = document.getElementById("username").value.trim();
      const pass = document.getElementById("password").value.trim();
      const allowed = accountData?.login;
      if (allowed && allowed.user === user && allowed.pass === pass) {
        document.getElementById("alertForm").classList.remove("hidden");
        document.getElementById("loginSection").classList.add("hidden");
      } else {
        document.getElementById("loginError").classList.remove("hidden");
      }
    }

    function saveAlert() {
      const t = document.getElementById("token").value;
      const c = document.getElementById("chat").value;
      const m = document.getElementById("msg").value;
      console.log("Save alert for", accountId, t, c, m);
      alert("ğŸš€ ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ (ØªØ¬Ø±ÙŠØ¨ÙŠ ÙÙ‚Ø· Ø­Ø§Ù„ÙŠØ§Ù‹)");
    }

    loadAccount();
  </script>
</body>
</html>
